---
const currentPath = Astro.url.pathname;

// Helper function to check if a route is active
const isActive = (href: string) => {
  // Remove trailing slash from both for comparison
  const normalizedCurrent = currentPath.replace(/\/$/, "") || "/";
  const normalizedHref = href.replace(/\/$/, "") || "/";
  return normalizedCurrent === normalizedHref;
};
---

<nav
  id="navbar"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 ease-in-out navbar-default"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a
          href="/"
          class={`font-display text-xl tracking-tight transition-colors duration-200 ${
            isActive("/")
              ? "text-orange-500"
              : "text-black hover:text-orange-400"
          }`}
        >
          SOLARIS <span class="text-orange-500">SOFTWARE</span>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:block">
        <div class="ml-10 flex items-center gap-8">
          <div class="flex items-baseline gap-7">
          <a
            href="/services/"
            class={`font-ui text-sm font-medium transition-all duration-200 relative ${
              isActive("/services/")
                ? "text-orange-500"
                : "text-black hover:text-orange-400"
            }`}
          >
            Services
            {
              isActive("/services/") && (
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 bg-orange-500 rounded-full" />
              )
            }
          </a>
          <a
            href="/case-studies/"
            class={`font-ui text-sm font-medium transition-all duration-200 relative ${
              isActive("/case-studies/")
                ? "text-orange-500"
                : "text-black hover:text-orange-400"
            }`}
          >
            Case Studies
            {
              isActive("/case-studies/") && (
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 bg-orange-500 rounded-full" />
              )
            }
          </a>
          <a
            href="/projects/"
            class={`font-ui text-sm font-medium transition-all duration-200 relative ${
              isActive("/projects/")
                ? "text-orange-500"
                : "text-black hover:text-orange-400"
            }`}
          >
            Projects
            {
              isActive("/projects/") && (
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 bg-orange-500 rounded-full" />
              )
            }
          </a>
          <a
            href="/articles/"
            class={`font-ui text-sm font-medium transition-all duration-200 relative ${
              isActive("/articles/")
                ? "text-orange-500"
                : "text-black hover:text-orange-400"
            }`}
          >
            Articles
            {
              isActive("/articles/") && (
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 bg-orange-500 rounded-full" />
              )
            }
          </a>
          <a
            href="/testimonials/"
            class={`font-ui text-sm font-medium transition-all duration-200 relative ${
              isActive("/testimonials/")
                ? "text-orange-500"
                : "text-black hover:text-orange-400"
            }`}
          >
            Testimonials
            {
              isActive("/testimonials/") && (
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 bg-orange-500 rounded-full" />
              )
            }
          </a>
          <a
            href="/team/"
            class={`font-ui text-sm font-medium transition-all duration-200 relative ${
              isActive("/team/")
                ? "text-orange-500"
                : "text-black hover:text-orange-400"
            }`}
          >
            Team
            {
              isActive("/team/") && (
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 bg-orange-500 rounded-full" />
              )
            }
          </a>
          </div>
          <div class="flex items-center gap-3 pl-6 border-l border-black/10">
            <a
              href="/inquiry/"
              class={`inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold transition-all duration-200 ${
                isActive("/inquiry/")
                  ? "bg-orange-500 text-white shadow-lg shadow-orange-500/20"
                  : "bg-orange-500 text-white hover:bg-orange-600"
              }`}
            >
              Inquiry
            </a>
            <a
              href="/contact/"
              class={`inline-flex items-center justify-center px-4 py-2 rounded-full text-sm font-semibold border transition-all duration-200 ${
                isActive("/contact/")
                  ? "border-orange-500 text-orange-500"
                  : "border-black/10 text-black hover:border-orange-500 hover:text-orange-500"
              }`}
            >
              Contact
            </a>
          </div>
        </div>
      </div>

      <!-- Mobile menu button -->
      <div class="md:hidden">
        <button
          id="mobile-menu-button"
          type="button"
          class="text-black hover:text-orange-400 focus:outline-none focus:text-orange-400 transition-colors duration-200"
          aria-controls="mobile-menu"
          aria-expanded="false"
        >
          <span class="sr-only">Open main menu</span>
          <!-- Hamburger icon -->
          <svg
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div
    class="md:hidden"
    id="mobile-menu"
    style="display: none; opacity: 0; transform: translateY(-10px);"
  >
    <div
      class="px-4 pt-4 pb-4 space-y-3 bg-black bg-opacity-98 backdrop-blur-md shadow-lg"
    >
      <div class="grid grid-cols-1 gap-3 pb-2">
        <a
          href="/inquiry/"
          class={`block px-4 py-3 rounded-full font-ui text-sm font-semibold text-center transition-all duration-200 ${
            isActive("/inquiry/")
              ? "bg-orange-500 text-white"
              : "bg-orange-500 text-white hover:bg-orange-600"
          }`}
        >
          Start an Inquiry
        </a>
        <a
          href="/contact/"
          class={`block px-4 py-3 rounded-full font-ui text-sm font-semibold text-center border transition-all duration-200 ${
            isActive("/contact/")
              ? "border-orange-500 text-orange-500"
              : "border-white/20 text-white hover:border-orange-500 hover:text-orange-400"
          }`}
        >
          Contact
        </a>
      </div>
      <a
        href="/"
        class={`block px-3 py-2 rounded-md font-ui text-base font-medium transition-colors duration-200 ${
          isActive("/")
            ? "text-orange-500 bg-orange-500/10"
            : "text-white hover:text-orange-400 hover:bg-white/5"
        }`}
      >
        Home
      </a>
      <a
        href="/services/"
        class={`block px-3 py-2 rounded-md font-ui text-base font-medium transition-colors duration-200 ${
          isActive("/services/")
            ? "text-orange-500 bg-orange-500/10"
            : "text-white hover:text-orange-400 hover:bg-white/5"
        }`}
      >
        Services
      </a>
      <a
        href="/case-studies/"
        class={`block px-3 py-2 rounded-md font-ui text-base font-medium transition-colors duration-200 ${
          isActive("/case-studies/")
            ? "text-orange-500 bg-orange-500/10"
            : "text-white hover:text-orange-400 hover:bg-white/5"
        }`}
      >
        Case Studies
      </a>
      <a
        href="/projects/"
        class={`block px-3 py-2 rounded-md font-ui text-base font-medium transition-colors duration-200 ${
          isActive("/projects/")
            ? "text-orange-500 bg-orange-500/10"
            : "text-white hover:text-orange-400 hover:bg-white/5"
        }`}
      >
        Projects
      </a>
      <a
        href="/articles/"
        class={`block px-3 py-2 rounded-md font-ui text-base font-medium transition-colors duration-200 ${
          isActive("/articles/")
            ? "text-orange-500 bg-orange-500/10"
            : "text-white hover:text-orange-400 hover:bg-white/5"
        }`}
      >
        Articles
      </a>
      <a
        href="/testimonials/"
        class={`block px-3 py-2 rounded-md font-ui text-base font-medium transition-colors duration-200 ${
          isActive("/testimonials/")
            ? "text-orange-500 bg-orange-500/10"
            : "text-white hover:text-orange-400 hover:bg-white/5"
        }`}
      >
        Testimonials
      </a>
      <a
        href="/team/"
        class={`block px-3 py-2 rounded-md font-ui text-base font-medium transition-colors duration-200 ${
          isActive("/team/")
            ? "text-orange-500 bg-orange-500/10"
            : "text-white hover:text-orange-400 hover:bg-white/5"
        }`}
      >
        Team
      </a>
    </div>
  </div>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navbar = document.getElementById("navbar");
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    let isScrolled = false;

    // Handle scroll events for background change
    function handleScroll() {
      const scrollTop =
        window.pageYOffset || document.documentElement.scrollTop;
      const shouldHaveBackground = scrollTop > 50;

      if (shouldHaveBackground !== isScrolled) {
        isScrolled = shouldHaveBackground;

        if (isScrolled) {
          navbar?.classList.add("navbar-scrolled");
        } else {
          navbar?.classList.remove("navbar-scrolled");
        }
      }
    }

    // Handle mobile menu toggle with smooth animation
    function toggleMobileMenu() {
      const isOpen = mobileMenu?.style.display !== "none";

      if (mobileMenu) {
        if (isOpen) {
          // Close menu
          mobileMenu.style.opacity = "0";
          mobileMenu.style.transform = "translateY(-10px)";
          setTimeout(() => {
            mobileMenu.style.display = "none";
          }, 200);
        } else {
          // Open menu
          mobileMenu.style.display = "block";
          mobileMenu.style.opacity = "0";
          mobileMenu.style.transform = "translateY(-10px)";

          // Force reflow
          mobileMenu.offsetHeight;

          mobileMenu.style.opacity = "1";
          mobileMenu.style.transform = "translateY(0)";
        }
      }
      mobileMenuButton?.setAttribute("aria-expanded", String(!isOpen));
    }

    // Event listeners
    window.addEventListener("scroll", handleScroll, { passive: true });
    mobileMenuButton?.addEventListener("click", toggleMobileMenu);

    // Close mobile menu when clicking on links
    const mobileLinks = mobileMenu?.querySelectorAll("a");
    mobileLinks?.forEach((link) => {
      link.addEventListener("click", () => {
        if (mobileMenu && mobileMenu.style.display !== "none") {
          mobileMenu.style.opacity = "0";
          mobileMenu.style.transform = "translateY(-10px)";
          setTimeout(() => {
            mobileMenu.style.display = "none";
          }, 200);
        }
        mobileMenuButton?.setAttribute("aria-expanded", "false");
      });
    });

    // Close mobile menu when clicking outside
    document.addEventListener("click", (event) => {
      const target = event.target as Element;
      if (mobileMenu?.style.display !== "none" && !navbar?.contains(target)) {
        if (mobileMenu) {
          mobileMenu.style.opacity = "0";
          mobileMenu.style.transform = "translateY(-10px)";
          setTimeout(() => {
            mobileMenu.style.display = "none";
          }, 200);
        }
        mobileMenuButton?.setAttribute("aria-expanded", "false");
      }
    });

    // Handle escape key to close mobile menu
    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape" && mobileMenu?.style.display !== "none") {
        if (mobileMenu) {
          mobileMenu.style.opacity = "0";
          mobileMenu.style.transform = "translateY(-10px)";
          setTimeout(() => {
            mobileMenu.style.display = "none";
          }, 200);
        }
        mobileMenuButton?.setAttribute("aria-expanded", "false");
      }
    });

    // Initial scroll check
    handleScroll();
  });
</script>

<style>
  /* Default navbar state - subtle backdrop for visibility */
  .navbar-default {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* Scrolled navbar state - solid white background */
  .navbar-scrolled {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow:
      0 1px 3px 0 rgba(0, 0, 0, 0.1),
      0 1px 2px 0 rgba(0, 0, 0, 0.06);
  }

  .navbar-scrolled a {
    color: #1f2937 !important;
  }

  .navbar-scrolled a:hover {
    color: #ff3d00 !important;
  }

  .navbar-scrolled a.text-orange-500 {
    color: #ff3d00 !important;
  }

  .navbar-scrolled button {
    color: #1f2937 !important;
  }

  .navbar-scrolled button:hover {
    color: #ff3d00 !important;
  }

  /* Mobile menu improvements */
  #mobile-menu {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 1px;
  }

  /* Ensure proper touch targets on mobile */
  @media (max-width: 768px) {
    .navbar-default,
    .navbar-scrolled {
      padding-top: env(safe-area-inset-top);
    }

    #mobile-menu a {
      min-height: 44px;
      display: flex;
      align-items: center;
    }

    #mobile-menu-button {
      min-height: 44px;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  }

  /* Animation for mobile menu */
  #mobile-menu {
    transition: all 0.2s ease-in-out;
  }
</style>
