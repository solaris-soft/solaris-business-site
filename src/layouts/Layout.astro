---
import Navbar from "@/components/navigation/Navbar.astro";
import Footer from "@/components/footer/footer.astro";
import SEO from "@/components/SEO.astro";
import "../styles/global.css";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: "website" | "article" | "service" | "profile";
  publishDate?: Date;
  keywords?: string;
  category?: string;
}

const {
  title = "SOLARIS SOFTWARE",
  description = "a botique software agency based in Perth, Western Australia",
  image,
  type,
  publishDate,
  keywords,
  category,
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Resource hints for faster loading -->
    <link rel="preconnect" href="https://api.fontshare.com" crossorigin />
    <link rel="preconnect" href="https://fonts.bunny.net" crossorigin />
    <link rel="dns-prefetch" href="https://api.fontshare.com" />
    <link rel="dns-prefetch" href="https://fonts.bunny.net" />

    <!-- Critical fonts preloaded for immediate render -->
    <link
      rel="preload"
      href="/fonts/satoshi-400.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/clash-display-600.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <SEO
      title={title}
      description={description}
      image={image}
      type={type}
      publishDate={publishDate}
      keywords={keywords}
      category={category}
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Non-critical fonts loaded asynchronously for better performance -->
    <link
      href="https://api.fontshare.com/v2/css?f[]=satoshi@300,700&f[]=clash-display@400,700&f[]=general-sans@400,600&f[]=jetbrains-mono@400&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <link
      href="https://fonts.bunny.net/css?family=source-sans-pro:400,600"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />

    <!-- Fallback for browsers that don't support onload -->
    <noscript>
      <link
        href="https://api.fontshare.com/v2/css?f[]=satoshi@300,700&f[]=clash-display@400,700&f[]=general-sans@400,600&f[]=jetbrains-mono@400&display=swap"
        rel="stylesheet"
      />
      <link
        href="https://fonts.bunny.net/css?family=source-sans-pro:400,600"
        rel="stylesheet"
      />
    </noscript>

    <!-- Prefetch next likely pages -->
    <link rel="prefetch" href="/services/" />
    <link rel="prefetch" href="/contact/" />
    <link rel="prefetch" href="/projects/" />
    <link rel="prefetch" href="/team/" />
    <link rel="sitemap" href="/sitemap-index.xml" />

    <!-- Structured data breadcrumbs helper -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://solaris.software/"
          }
        ]
      }
    </script>
    <!-- Additional SEO meta tags -->
    <meta name="theme-color" content="#ff3d00" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="SOLARIS SOFTWARE" />
    <meta name="application-name" content="SOLARIS SOFTWARE" />
    <meta name="msapplication-TileColor" content="#ff3d00" />
    <meta name="msapplication-config" content="/browserconfig.xml" />

    <!-- Performance and Security -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
  </head>
  <body>
    <div id="smooth-wrapper">
      <div id="smooth-content">
        <Navbar />
        <main>
          <slot />
        </main>
        <Footer />
      </div>
    </div>

    <script>
      import { gsap } from "gsap";
      import { ScrollTrigger } from "gsap/ScrollTrigger";
      import { ScrollSmoother } from "gsap/ScrollSmoother";

      // Register GSAP plugins
      gsap.registerPlugin(ScrollTrigger, ScrollSmoother);

      // Initialize ScrollSmoother when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        // Create ScrollSmoother instance
        const smoother = ScrollSmoother.create({
          wrapper: "#smooth-wrapper",
          content: "#smooth-content",
          smooth: 1.3, // Smoothness factor (0-3)
          effects: true, // Enable data-speed and data-lag effects
          smoothTouch: 0.1, // Smooth scrolling on touch devices
          normalizeScroll: true, // Prevent address bar from affecting scrolling on mobile
          ignoreMobileResize: true, // Don't refresh ScrollTriggers when mobile orientation changes
        });

        // Optional: Add some performance optimizations
        gsap.config({
          force3D: true,
          nullTargetWarn: false,
        });

        console.log("ScrollSmoother initialized successfully");
      });
    </script>
  </body>
</html>

<style is:global>
  /* Self-hosted critical fonts for immediate render */
  @font-face {
    font-family: "Satoshi";
    src: url("/fonts/satoshi-400.woff2") format("woff2");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }

  @font-face {
    font-family: "Clash Display";
    src: url("/fonts/clash-display-600.woff2") format("woff2");
    font-weight: 600;
    font-style: normal;
    font-display: swap;
  }

  :root {
    --primary: #ff3d00;
    --secondary: #ff8a00;
    --bg: #000000;
    --text: #ffffff;
    --vh: 1vh; /* Fallback for older browsers */
  }

  /* Support for dynamic viewport height on mobile */
  @supports (height: 100dvh) {
    :root {
      --vh: 1dvh;
    }
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: "Satoshi", sans-serif;
    font-weight: 600;
  }

  p {
    font-family: "General Sans", sans-serif;
  }
</style>
