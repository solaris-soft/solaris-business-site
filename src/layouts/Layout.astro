---
import Navbar from "@/components/navigation/Navbar.astro";
import Footer from "@/components/footer/footer.astro";
import SEO from "@/components/SEO.astro";
import "../styles/global.css";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: "website" | "article" | "service" | "profile";
  publishDate?: Date;
  keywords?: string;
  category?: string;
}

const {
  title = "SOLARIS SOFTWARE",
  description = "a botique software agency based in Perth, Western Australia",
  image,
  type,
  publishDate,
  keywords,
  category,
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Resource hints for faster loading -->
    <link rel="preconnect" href="https://api.fontshare.com" crossorigin />
    <link rel="preconnect" href="https://fonts.bunny.net" crossorigin />
    <link rel="dns-prefetch" href="https://api.fontshare.com" />
    <link rel="dns-prefetch" href="https://fonts.bunny.net" />

    <!-- Critical fonts preloaded for immediate render -->
    <link
      rel="preload"
      href="/fonts/satoshi-400.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/clash-display-600.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <SEO
      title={title}
      description={description}
      image={image}
      type={type}
      publishDate={publishDate}
      keywords={keywords}
      category={category}
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Optimized fonts - reduced weights for mobile performance -->
    <link
      href="https://api.fontshare.com/v2/css?f[]=satoshi@400,600&f[]=clash-display@600&f[]=general-sans@400,600&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />

    <!-- Only load secondary font on larger screens -->
    <link
      href="https://fonts.bunny.net/css?family=source-sans-pro:400&display=swap"
      rel="stylesheet"
      media="(min-width: 768px)"
    />

    <!-- Fallback for browsers that don't support onload -->
    <noscript>
      <link
        href="https://api.fontshare.com/v2/css?f[]=satoshi@400,600&f[]=clash-display@600&f[]=general-sans@400,600&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- Prefetch next likely pages -->
    <link rel="prefetch" href="/services/" />
    <link rel="prefetch" href="/contact/" />
    <link rel="prefetch" href="/projects/" />
    <link rel="prefetch" href="/team/" />
    <link rel="sitemap" href="/sitemap-index.xml" />

    <!-- Structured data breadcrumbs helper -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://solaris.software/"
          }
        ]
      }
    </script>
    <!-- Additional SEO meta tags -->
    <meta name="theme-color" content="#ff3d00" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="SOLARIS SOFTWARE" />
    <meta name="application-name" content="SOLARIS SOFTWARE" />
    <meta name="msapplication-TileColor" content="#ff3d00" />
    <meta name="msapplication-config" content="/browserconfig.xml" />

    <!-- Performance and Security -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
  </head>
  <body>
    <div id="smooth-wrapper">
      <div id="smooth-content">
        <Navbar />
        <main>
          <slot />
        </main>
        <Footer />
      </div>
    </div>

    <script>
      import { gsap } from "gsap";
      import { ScrollTrigger } from "gsap/ScrollTrigger";
      import { ScrollSmoother } from "gsap/ScrollSmoother";

      // Register GSAP plugins
      gsap.registerPlugin(ScrollTrigger, ScrollSmoother);

      // Mobile detection
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;

      // Initialize ScrollSmoother when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        // Only initialize ScrollSmoother on desktop for better mobile performance
        if (!isMobile) {
          const smoother = ScrollSmoother.create({
            wrapper: "#smooth-wrapper",
            content: "#smooth-content",
            smooth: 1.3,
            effects: true,
            smoothTouch: 0, // Disable on touch devices
            normalizeScroll: true,
            ignoreMobileResize: true,
          });

          console.log("ScrollSmoother initialized for desktop");
        } else {
          // For mobile, just use normal scrolling with basic setup
          document.body.style.overflow = 'auto';
          document.documentElement.style.overflow = 'auto';
          const wrapper = document.getElementById('smooth-wrapper');
          const content = document.getElementById('smooth-content');
          
          if (wrapper && content) {
            wrapper.style.position = 'static';
            wrapper.style.height = 'auto';
            wrapper.style.overflow = 'visible';
          }
          
          console.log("Mobile mode: ScrollSmoother disabled for performance");
        }

        // Performance optimizations
        gsap.config({
          force3D: !isMobile, // Disable 3D transforms on mobile
          nullTargetWarn: false,
        });
      });
    </script>
  </body>
</html>

<style is:global>
  /* Self-hosted critical fonts for immediate render */
  @font-face {
    font-family: "Satoshi";
    src: url("/fonts/satoshi-400.woff2") format("woff2");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }

  @font-face {
    font-family: "Clash Display";
    src: url("/fonts/clash-display-600.woff2") format("woff2");
    font-weight: 600;
    font-style: normal;
    font-display: swap;
  }

  :root {
    --primary: #ff3d00;
    --secondary: #ff8a00;
    --bg: #000000;
    --text: #ffffff;
    --vh: 1vh; /* Fallback for older browsers */
  }

  /* Support for dynamic viewport height on mobile */
  @supports (height: 100dvh) {
    :root {
      --vh: 1dvh;
    }
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: "Satoshi", sans-serif;
    font-weight: 600;
  }

  p {
    font-family: "General Sans", sans-serif;
  }
</style>
