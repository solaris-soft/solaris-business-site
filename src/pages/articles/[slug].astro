---
export const prerender = true;
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const articles = await getCollection("articles", ({ data }) => !data.draft);
  return articles.map((article) => ({
    params: { slug: article.slug },
  }));
}

const { slug } = Astro.params;
const articles = await getCollection("articles");
const article = articles.find((a) => a.slug === slug);

if (!article) {
  return Astro.redirect("/404/");
}

const { Content } = await article.render();
const hasBodyHtml = article.data.body != null && article.data.body !== "";
---

<Layout
  title={`${article.data.title} | Solaris Software`}
  description={article.data.description}
  type="article"
  publishDate={article.data.publishDate}
  category="Blog"
>
  <div class="min-h-screen bg-white relative overflow-hidden">
    <!-- Subtle background accent -->
    <div
      class="absolute inset-0 bg-gradient-to-br from-orange-50/30 via-transparent to-orange-50/20 pointer-events-none"
      >
    </div>

    <!-- Reading Progress Indicator -->
    <div
      class="fixed top-0 left-0 right-0 h-1 bg-gray-100 z-50"
      id="reading-progress"
    >
      <div
        class="h-full bg-gradient-to-r from-orange-500 to-orange-600 transition-all duration-150"
        style="width: 0%"
        id="reading-progress-bar"
      >
      </div>
    </div>

    <!-- Article Header + Content (unified flow) -->
    <section class="pt-12 md:pt-16 pb-16 md:pb-24 relative">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <!-- Back Button -->
          <a
            href="/articles/"
          class="inline-flex items-center text-orange-600 hover:text-orange-700 font-medium text-sm mb-6 transition-all duration-300 group"
          >
            <svg
              class="w-4 h-4 mr-2 transition-transform duration-300 group-hover:-translate-x-1"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              />
            </svg>
            Back to Articles
          </a>

          <!-- Article Meta -->
        <div class="flex flex-wrap items-center gap-3 mb-4">
            <time
              class="text-sm font-medium text-gray-500 flex items-center gap-2"
              datetime={article.data.publishDate.toISOString()}
            >
              <svg
                class="w-4 h-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              {article.data.publishDate.toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })}
            </time>
          <span class="text-gray-300">·</span>
            <span class="text-sm font-medium text-gray-500">
              {article.data.author}
            </span>
            {article.data.tags && article.data.tags.length > 0 && (
              <>
              <span class="text-gray-300">·</span>
                <div class="flex flex-wrap gap-2">
                  {article.data.tags.map((tag) => (
                    <span
                    class="text-xs font-medium px-2.5 py-0.5 rounded-full bg-orange-100 text-orange-700"
                    >
                      {tag}
                    </span>
                  ))}
                </div>
              </>
            )}
          </div>

          <!-- Article Title -->
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-display text-gray-900 mb-4 leading-tight">
            {article.data.title}
          </h1>

          <!-- Article Description -->
        <p class="text-lg text-gray-500 leading-relaxed mb-10">
            {article.data.description}
          </p>

        <!-- Cover Image -->
        {article.data.coverImage && (
          <div
            class="mb-10 rounded-2xl overflow-hidden shadow-lg relative group"
          >
            <img
              src={article.data.coverImage.src}
              alt={article.data.title}
              class="w-full h-auto"
              loading="eager"
            />
          </div>
        )}

        <!-- Article Body -->
        <article
          class="prose prose-lg prose-gray prose-headings:font-display prose-headings:text-gray-900 prose-h1:text-2xl prose-h1:md:text-3xl prose-a:text-orange-600 prose-a:no-underline hover:prose-a:underline prose-img:rounded-xl prose-img:shadow-lg prose-pre:rounded-xl prose-pre:bg-gray-900"
        >
          {hasBodyHtml ? (
            <Fragment set:html={article.data.body} />
          ) : (
            <Content />
          )}
        </article>
      </div>
    </section>

    <!-- Related Articles Section -->
    <section class="py-12 md:py-16 border-t border-gray-100 relative">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div>
          <h2
            class="text-3xl md:text-4xl font-display text-gray-900 mb-12 leading-tight"
          >
            More Articles
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            {articles
              .filter((a) => a.slug !== article.slug)
              .sort((a, b) =>
                b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
              )
              .slice(0, 2)
              .map((relatedArticle) => (
                <a
                  href={`/articles/${relatedArticle.slug}/`}
                  class="group bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-2xl hover:shadow-orange-500/15 transition-all duration-500 hover:-translate-y-3 relative"
                >
                  {/* Gradient overlay on hover */}
                  <div
                    class="absolute inset-0 bg-gradient-to-br from-orange-500/0 to-orange-500/0 group-hover:from-orange-500/5 group-hover:to-transparent transition-all duration-500 rounded-2xl pointer-events-none z-10"
                  >
                  </div>

                  {relatedArticle.data.coverImage && (
                    <div class="aspect-[16/10] overflow-hidden bg-gray-50 relative">
                      <img
                        src={relatedArticle.data.coverImage.src}
                        alt={relatedArticle.data.title}
                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                        loading="lazy"
                      />
                      {/* Overlay gradient */}
                      <div
                        class="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"
                      >
                      </div>
                    </div>
                  )}

                  <div class="p-6 relative z-10">
                    <div class="flex items-center gap-2 mb-4 flex-wrap">
                      <time
                        class="text-xs font-medium text-gray-500 flex items-center gap-1"
                        datetime={relatedArticle.data.publishDate.toISOString()}
                      >
                        <svg
                          class="w-3 h-3"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                          />
                        </svg>
                        {relatedArticle.data.publishDate.toLocaleDateString(
                          "en-US",
                          {
                            year: "numeric",
                            month: "short",
                            day: "numeric",
                          },
                        )}
                      </time>
                      {relatedArticle.data.tags &&
                        relatedArticle.data.tags.length > 0 && (
                          <>
                            <span class="text-gray-300">•</span>
                            <span
                              class="text-xs font-medium px-2 py-1 rounded-full bg-orange-100 text-orange-700 group-hover:bg-orange-200 transition-colors duration-300"
                            >
                              {relatedArticle.data.tags[0]}
                            </span>
                          </>
                        )}
                    </div>

                    <h3
                      class="text-xl font-display text-gray-900 mb-3 group-hover:text-orange-600 transition-colors duration-300 leading-tight"
                    >
                      {relatedArticle.data.title}
                    </h3>

                    <p
                      class="text-gray-600 text-sm leading-relaxed mb-5 line-clamp-3"
                    >
                      {relatedArticle.data.description}
                    </p>

                    <div
                      class="flex items-center text-orange-600 font-medium text-sm group-hover:text-orange-700 transition-colors duration-300"
                    >
                      <span>Read Article</span>
                      <svg
                        class="w-4 h-4 ml-2 transition-transform duration-300 group-hover:translate-x-2"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                        />
                      </svg>
                    </div>
                  </div>
                </a>
              ))}
          </div>
        </div>
      </div>
    </section>

    <!-- Call to Action Section -->
    <section class="py-12 md:py-16 bg-gradient-to-br from-orange-50/50 to-white relative">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
        <h2
          class="text-3xl md:text-4xl font-display text-gray-900 mb-6 leading-tight"
        >
          Want to Work With Us?
        </h2>
        <p
          class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto leading-relaxed"
        >
          Let's discuss how we can help you bring your ideas to life with our
          expertise in web development, AI solutions, and digital innovation.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/contact/"
            class="inline-flex items-center justify-center px-8 py-4 bg-orange-500 text-white font-semibold rounded-full hover:bg-orange-600 transition-all duration-300 shadow-lg hover:shadow-xl"
          >
            Get Started
          </a>
          <a
            href="/services/"
            class="inline-flex items-center justify-center px-8 py-4 bg-white text-gray-900 font-semibold rounded-full hover:bg-gray-50 transition-all duration-300 border border-gray-200"
          >
            Our Services
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  /* Prose styling override for better reading experience */
  article.prose {
    color: #374151;
  }

  /* In-content H1s should be subordinate to the page title */
  article.prose h1 {
    font-size: 1.75rem;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    font-weight: 600;
    line-height: 1.3;
  }

  @media (min-width: 768px) {
    article.prose h1 {
      font-size: 2rem;
    }
  }

  article.prose h2 {
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    font-size: 1.5rem;
    font-weight: 600;
    line-height: 1.3;
  }

  article.prose h3 {
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    font-size: 1.25rem;
    font-weight: 600;
  }

  article.prose p {
    margin-bottom: 1.25rem;
    line-height: 1.75;
  }

  article.prose ul,
  article.prose ol {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }

  article.prose li {
    margin-bottom: 0.5rem;
  }

  article.prose blockquote {
    border-left: 4px solid #ff3d00;
    padding-left: 1.5rem;
    font-style: italic;
    color: #6b7280;
    margin: 2rem 0;
  }

  article.prose code {
    background-color: #f3f4f6;
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  article.prose pre {
    background-color: #1f2937;
    color: #f9fafb;
    overflow-x: auto;
  }

  article.prose pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
  }

  article.prose img {
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  /* Line clamp utility */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Smooth transitions */
  .transition-all {
    transition-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* Reading progress indicator */
  #reading-progress {
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #reading-progress.visible {
    opacity: 1;
  }
</style>

<script>
  // Reading progress indicator
  document.addEventListener("DOMContentLoaded", function () {
    const progressBar = document.getElementById("reading-progress-bar");
    const progressContainer = document.getElementById("reading-progress");
    const article = document.querySelector("article");

    if (!progressBar || !progressContainer || !article) return;

    function updateProgress() {
      const articleTop = article.offsetTop;
      const articleHeight = article.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrollTop = window.scrollY;

      const articleBottom = articleTop + articleHeight;
      const windowBottom = scrollTop + windowHeight;

      if (windowBottom > articleTop && scrollTop < articleBottom) {
        progressContainer.classList.add("visible");
        const scrolled = windowBottom - articleTop;
        const progress = Math.min(
          (scrolled / (articleHeight + windowHeight)) * 100,
          100,
        );
        progressBar.style.width = `${progress}%`;
      } else if (scrollTop < articleTop) {
        progressContainer.classList.remove("visible");
        progressBar.style.width = "0%";
      } else {
        progressBar.style.width = "100%";
      }
    }

    window.addEventListener("scroll", updateProgress);
    updateProgress();
  });
</script>
