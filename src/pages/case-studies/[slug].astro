---
export const prerender = true;
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const caseStudies = await getCollection("caseStudies", ({ data }) => !data.draft);
  return caseStudies.map((caseStudy) => ({
    params: { slug: caseStudy.slug },
    props: { caseStudy },
  }));
}

const { caseStudy } = Astro.props;
const { Content } = await caseStudy.render();
const hasBodyHtml = caseStudy.data.body != null && caseStudy.data.body !== "";
---

<Layout
  title={`${caseStudy.data.title} | Case Study | Solaris Software`}
  description={caseStudy.data.description}
  image={caseStudy.data.heroImage?.src}
  type="article"
  publishDate={caseStudy.data.publishDate ?? undefined}
  keywords={`case study, ${caseStudy.data.client}, ${caseStudy.data.title}, web development success stories`}
  category="Case Study"
>
  <main class="min-h-screen bg-white relative overflow-hidden">
    <!-- Enhanced Background Effects -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <!-- Gradient orbs -->
      <div
        class="absolute w-[500px] h-[500px] -top-[250px] -right-[250px] bg-gradient-radial from-[#ff3d00]/5 via-transparent to-transparent opacity-30 blur-3xl"
      >
      </div>
      <div
        class="absolute w-[400px] h-[400px] -bottom-[200px] -left-[200px] bg-gradient-radial from-[#ff8a00]/5 via-transparent to-transparent opacity-20 blur-3xl"
      >
      </div>
    </div>

    <!-- Reading Progress Indicator -->
    <div
      class="fixed top-0 left-0 right-0 h-1 bg-gray-100 z-50"
      id="reading-progress"
    >
      <div
        class="h-full bg-gradient-to-r from-orange-500 to-orange-600 transition-all duration-150"
        style="width: 0%"
        id="reading-progress-bar"
      >
      </div>
    </div>

    <!-- Header Section -->
    <section class="py-20 bg-white relative">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="mb-8">
          <ol class="flex items-center space-x-2 text-sm flex-wrap">
            <li>
              <a
                href="/"
                class="text-gray-500 hover:text-orange-600 transition-colors"
              >
                Home
              </a>
            </li>
            <li class="text-gray-400">/</li>
            <li>
              <a
                href="/case-studies/"
                class="text-gray-500 hover:text-orange-600 transition-colors"
              >
                Case Studies
              </a>
            </li>
            <li class="text-gray-400">/</li>
            <li class="text-gray-900 font-medium truncate max-w-xs">
              {caseStudy.data.title}
            </li>
          </ol>
        </nav>

        <!-- Client Badge -->
        <div class="mb-6">
          <span
            class="inline-block text-sm font-medium px-4 py-2 rounded-full bg-orange-100 text-orange-700"
          >
            {caseStudy.data.client}
          </span>
        </div>

        <!-- Title -->
        <h1
          class="text-4xl md:text-5xl font-display text-gray-900 mb-6 leading-tight"
        >
          {caseStudy.data.title}
        </h1>

        <!-- Meta Information -->
        {(caseStudy.data.publishDate || (caseStudy.data.tags && caseStudy.data.tags.length > 0)) && (
          <div
            class="flex flex-wrap items-center gap-4 text-gray-600 text-sm mb-8"
          >
            {caseStudy.data.publishDate && (
              <time
                class="flex items-center gap-2"
                datetime={caseStudy.data.publishDate.toISOString()}
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                  />
                </svg>
                {caseStudy.data.publishDate.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
            )}
            {caseStudy.data.tags && caseStudy.data.tags.length > 0 && (
              <>
                {caseStudy.data.publishDate && <span class="text-gray-300">â€¢</span>}
                <div class="flex flex-wrap gap-2">
                  {caseStudy.data.tags.map((tag) => (
                    <span
                      class="text-sm px-2 py-1 rounded bg-gray-100 text-gray-700"
                    >
                      {tag}
                    </span>
                  ))}
                </div>
              </>
            )}
          </div>
        )}

        <!-- Hero Image -->
        {caseStudy.data.heroImage && (
          <div class="mb-16 rounded-2xl overflow-hidden shadow-2xl relative group">
            <img
              src={caseStudy.data.heroImage.src}
              alt={caseStudy.data.title}
              class="w-full h-auto transition-transform duration-700 group-hover:scale-105"
              loading="eager"
            />
            {/* Gradient overlay */}
            <div
              class="absolute inset-0 bg-gradient-to-t from-black/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"
            >
            </div>
          </div>
        )}

        <!-- Problem, Solution, Outcome -->
        <div class="space-y-12 mb-16">
          <div class="rounded-2xl p-8 border border-gray-100 bg-gray-50/50">
            <h2 class="text-xl font-display text-gray-900 mb-4 flex items-center gap-3">
              <span class="w-1 h-6 bg-orange-500 rounded-full"></span>
              The Problem
            </h2>
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">
              {caseStudy.data.problem}
            </p>
          </div>
          <div class="rounded-2xl p-8 border border-gray-100 bg-gray-50/50">
            <h2 class="text-xl font-display text-gray-900 mb-4 flex items-center gap-3">
              <span class="w-1 h-6 bg-orange-500 rounded-full"></span>
              Our Solution
            </h2>
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">
              {caseStudy.data.solution}
            </p>
          </div>
          <div class="rounded-2xl p-8 border border-orange-100 bg-gradient-to-br from-orange-50/50 to-white shadow-sm">
            <h2 class="text-xl font-display text-gray-900 mb-4 flex items-center gap-3">
              <span class="w-1 h-6 bg-gradient-to-b from-orange-500 to-orange-600 rounded-full"></span>
              Outcome
            </h2>
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">
              {caseStudy.data.outcome}
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Content Section -->
    <section class="py-12 bg-gray-50/50 relative">
      <!-- Subtle pattern overlay -->
      <div class="absolute inset-0 opacity-[0.02]">
        <div
          class="absolute inset-0"
          style="background-image: radial-gradient(circle at 1px 1px, #ff3d00 1px, transparent 0); background-size: 24px 24px;"
        >
        </div>
      </div>
      <article
        class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 prose prose-lg"
      >
        {hasBodyHtml ? (
          <Fragment set:html={caseStudy.data.body} />
        ) : (
          <Content />
        )}
      </article>
    </section>

    <!-- Related Case Studies / CTA -->
    <section class="py-16 md:py-24 bg-white relative">
      <!-- Subtle background accent -->
      <div
        class="absolute inset-0 bg-gradient-to-br from-orange-50/20 via-transparent to-transparent"
      >
      </div>
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="text-center mb-12">
          <h2
            class="text-3xl md:text-4xl font-display text-gray-900 mb-6 leading-tight"
          >
            Want Similar Results?
          </h2>
          <p
            class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto leading-relaxed"
          >
            Let's discuss how we can help your business achieve its digital transformation goals.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a
              href="/contact/"
              class="inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-medium rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all duration-300 hover:shadow-lg hover:shadow-orange-500/25 hover:scale-105"
            >
              Start a Project
              <svg
                class="w-5 h-5 ml-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 8l4 4m0 0l-4 4m4-4H3"
                ></path>
              </svg>
            </a>
          </div>
        </div>

        <!-- Back to All Case Studies -->
        <div class="text-center mt-12 pt-12 border-t border-gray-100">
          <a
            href="/case-studies/"
            class="inline-flex items-center text-orange-600 font-medium hover:text-orange-700 transition-all duration-300 group"
          >
            <svg
              class="w-5 h-5 mr-2 transition-transform duration-300 group-hover:-translate-x-1"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"
              />
            </svg>
            View All Case Studies
          </a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Reading progress indicator */
  #reading-progress {
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #reading-progress.visible {
    opacity: 1;
  }
</style>

<script>
  // Reading progress indicator
  document.addEventListener("DOMContentLoaded", function () {
    const progressBar = document.getElementById("reading-progress-bar");
    const progressContainer = document.getElementById("reading-progress");
    const article = document.querySelector("article");

    if (!progressBar || !progressContainer || !article) return;

    function updateProgress() {
      const articleTop = article.offsetTop;
      const articleHeight = article.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrollTop = window.scrollY;

      const articleBottom = articleTop + articleHeight;
      const windowBottom = scrollTop + windowHeight;

      if (windowBottom > articleTop && scrollTop < articleBottom) {
        progressContainer.classList.add("visible");
        const scrolled = windowBottom - articleTop;
        const progress = Math.min(
          (scrolled / (articleHeight + windowHeight)) * 100,
          100,
        );
        progressBar.style.width = `${progress}%`;
      } else if (scrollTop < articleTop) {
        progressContainer.classList.remove("visible");
        progressBar.style.width = "0%";
      } else {
        progressBar.style.width = "100%";
      }
    }

    window.addEventListener("scroll", updateProgress);
    updateProgress();
  });
</script>
